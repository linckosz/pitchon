	<div id="begin_quiz_result_refresh" class="visibility_hidden">

		{# Can use autobahn v0.8.2 max for it WAMPv! supprt (Ratchet limitation), because newer only support WAMPv2 (not Ratchet) #}
		<script src="{{ _filelatest('/scripts/libs/autobahn.js') }}" type="text/javascript"></script>
		<script type="text/javascript">
			var begin_quiz_result_refresh_conn;

			var begin_quiz_result_refresh_loop = 60; //Allow only 60 restart (1min offline), after that the user must refresh manuall
			//Force deconnection after 3H of listening
			setTimeout(function(){
				begin_quiz_result_refresh_loop = false;
			}, 3*3600*1000);
			
			var begin_quiz_result_refresh_question = getCookie("question");
			if(begin_quiz_result_refresh_question){
				begin_quiz_result_refresh_question = parseInt(begin_quiz_result_refresh_question, 10);
			} else {
				begin_quiz_result_refresh_question = false;
			}

			var begin_quiz_result_refresh_code = getCookie("code");
			if(begin_quiz_result_refresh_code){
				begin_quiz_result_refresh_code = parseInt(begin_quiz_result_refresh_code, 10);
				if(begin_quiz_result_refresh_code > 0){
					var begin_quiz_result_refresh_start = function(){
						begin_quiz_result_refresh_conn = new ab.Session(
							'wss://quiz.pitchon.net:9443',
							function(){
								begin_quiz_result_refresh_loop = 60; //Reset
								begin_quiz_result_refresh_conn.subscribe(
									begin_quiz_result_refresh_code.toString(), //This is the TopicID (must be a string)
									function(topic, data){
										if(
											   typeof data == 'object'
											&& typeof data['data'] != "undefined"
											&& data['data'] != "{{ data_question_id }}"
										){
											window.location.href = '/c/'+begin_quiz_result_refresh_code;
										}
									}
								);
							},
							function(){
								if(begin_quiz_result_refresh_loop && begin_quiz_result_refresh_loop>0){
									begin_quiz_result_refresh_loop--;
									setTimeout(function(){
										begin_quiz_result_refresh_start();
									}, 1000);
								}
							},
							{
								'skipSubprotocolCheck': true,
							}
						);
					}
					begin_quiz_result_refresh_start();
				}
			}

		</script>

	</div>
	<div id="end_quiz_result_refresh" class="visibility_hidden"></div>
